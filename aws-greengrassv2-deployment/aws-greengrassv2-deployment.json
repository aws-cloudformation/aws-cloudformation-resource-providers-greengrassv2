{
    "typeName": "AWS::GreengrassV2::Deployment",
    "description": "Resource for Greengrass V2 deployment.",
    "sourceUrl": "https://finthomp.aka.corp.amazon.com/docs/evergreen-api/mainline/greengrass/v2/APIReference/API_CreateDeployment.html",
    "definitions": {
        "MaxJobExecutionsPerMin": {
            "type": "integer",
            "minimum": 1,
            "maximum": 1000
        },
        "ConfigurationValidationPolicy": {
            "type": "object",
            "properties": {
                "Timeout": {
                    "type": "integer"
                }
            }
        },
        "ComponentUpdatePolicyAction": {
            "type": "string",
            "enum": [
                "NOTIFY_COMPONENTS",
                "SKIP_NOTIFY_COMPONENTS"
            ]
        },
        "ComponentUpdatePolicy": {
            "type": "object",
            "properties": {
                "Timeout": {
                    "type": "integer"
                },
                "Action": {
                    "$ref": "#/definitions/ComponentUpdatePolicyAction"
                }
            }
        },
        "FailureHandlingPolicy": {
            "type": "string",
            "enum": [
                "ROLLBACK",
                "DO_NOTHING"
            ]
        },
        "DeploymentPolicies": {
            "type": "object",
            "properties": {
                "FailureHandlingPolicy": {
                    "$ref": "#/definitions/FailureHandlingPolicy"
                },
                "ComponentUpdatePolicy": {
                    "$ref": "#/definitions/ComponentUpdatePolicy"
                },
                "ConfigurationValidationPolicy": {
                    "$ref": "#/definitions/ConfigurationValidationPolicy"
                }
            }
        },
        "NumberOfThings": {
            "type": "integer",
            "minimum": 1
        },
        "RateIncreaseCriteria": {
            "type": "object",
            "properties": {
                "NumberOfNotifiedThings": {
                    "$ref": "#/definitions/NumberOfThings"
                },
                "NumberOfSucceededThings": {
                    "$ref": "#/definitions/NumberOfThings"
                }
            }
        },
        "IncrementFactor": {
            "type": "integer",
            "minimum": 1,
            "maximum": 5
        },
        "RolloutRatePerMinute": {
            "type": "integer",
            "minimum": 1,
            "maximum": 1000
        },
        "ExponentialRolloutRate": {
            "type": "object",
            "properties": {
                "BaseRatePerMinute": {
                    "$ref": "#/definitions/RolloutRatePerMinute"
                },
                "IncrementFactor": {
                    "$ref": "#/definitions/IncrementFactor"
                },
                "RateIncreaseCriteria": {
                    "$ref": "#/definitions/RateIncreaseCriteria"
                }
            },
            "required": [
                "BaseRatePerMinute",
                "IncrementFactor",
                "RateIncreaseCriteria"
            ]
        },
        "JobExecutionsRolloutConfig": {
            "type": "object",
            "properties": {
                "ExponentialRate": {
                    "$ref": "#/definitions/ExponentialRolloutRate"
                },
                "MaximumPerMinute": {
                    "$ref": "#/definitions/MaxJobExecutionsPerMin"
                }
            }
        },
        "MinimumNumberOfExecutedThings": {
            "type": "integer",
            "minimum": 1
        },
        "AbortThresholdPercentage": {
            "type": "number",
            "minimum": 0,
            "maximum": 100
        },
        "AbortAction": {
            "type": "string",
            "enum": [
                "CANCEL"
            ]
        },
        "JobExecutionFailureType": {
            "type": "string",
            "enum": [
                "FAILED",
                "REJECTED",
                "TIMED_OUT",
                "ALL"
            ]
        },
        "AbortCriteria": {
            "type": "object",
            "properties": {
                "FailureType": {
                    "$ref": "#/definitions/JobExecutionFailureType"
                },
                "Action": {
                    "$ref": "#/definitions/AbortAction"
                },
                "ThresholdPercentage": {
                    "$ref": "#/definitions/AbortThresholdPercentage"
                },
                "MinNumberOfExecutedThings": {
                    "$ref": "#/definitions/MinimumNumberOfExecutedThings"
                }
            },
            "required": [
                "FailureType",
                "Action",
                "ThresholdPercentage",
                "MinNumberOfExecutedThings"
            ]
        },
        "AbortCriteriaList": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/AbortCriteria"
            }
        },
        "AbortConfig": {
            "type": "object",
            "properties": {
                "CriteriaList": {
                    "$ref": "#/definitions/AbortCriteriaList"
                }
            },
            "required": [
                "CriteriaList"
            ]
        },
        "InProgressTimeoutInMinutes": {
            "type": "integer",
            "minimum": 0
        },
        "TimeoutConfig": {
            "type": "object",
            "properties": {
                "InProgressTimeoutInMinutes": {
                    "$ref": "#/definitions/InProgressTimeoutInMinutes"
                }
            }
        },
        "IoTJobConfigurations": {
            "type": "object",
            "properties": {
                "JobExecutionsRolloutConfig": {
                    "$ref": "#/definitions/JobExecutionsRolloutConfig"
                },
                "AbortConfig": {
                    "$ref": "#/definitions/AbortConfig"
                },
                "TimeoutConfig": {
                    "$ref": "#/definitions/TimeoutConfig"
                }
            }
        },
        "ConfigurationUpdate": {
            "description": "The greengrass V2 ConfigurationUpdate",
            "type": "object",
            "properties": {
                "Merge": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 65535
                },
                "Reset": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "minLength": 1,
                        "maxLength": 256
                    }
                }
            }
        },
        "ComponentInfo": {
            "description": "The greengrass V2 componentInfo",
            "type": "object",
            "properties": {
                "Version": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 128
                },
                "ConfigurationUpdate": {
                    "$ref": "#/definitions/ConfigurationUpdate"
                }
            }
        }
    },
    "properties": {
        "TargetType": {
            "description": "The type of the target, should be either thing or thinggroup.",
            "type": "string",
            "enum": [
                "thing",
                "thinggroup"
            ]
        },
        "TargetName": {
            "description": "The name of the target.",
            "type": "string",
            "minLength": 1,
            "maxLength": 128
        },
        "DeploymentName": {
            "description": "The name of the deployment.",
            "type": "string",
            "minLength": 1,
            "maxLength": 128
        },
        "Components": {
            "type": "object",
            "patternProperties": {
                ".*": {
                    "$ref": "#/definitions/ComponentInfo"
                }
            }
        },
        "IotJobConfigurations": {
            "$ref": "#/definitions/IoTJobConfigurations"
        },
        "DeploymentPolicies": {
            "$ref": "#/definitions/DeploymentPolicies"
        }
    },
    "required": [
        "TargetType",
        "TargetName",
        "DeploymentName"
    ],
    "handlers": {
        "create": {
            "permissions": [
                "IoT:CreateThing",
                "IoT:DescribeThing"
            ]
        },
        "read": {
            "permissions": [
                "IoT:DescribeThing"
            ]
        },
        "update": {
            "permissions": [
            ]
        },
        "delete": {
            "permissions": [
                "IoT:DeleteThing"
            ]
        },
        "list": {
            "permissions": [
            ]
        }
    },
    "primaryIdentifier": [
        "/properties/TargetName",
        "/properties/TargetType",
        "/properties/DeploymentName"
    ],
    "additionalProperties": false,
    "readOnlyProperties": [
        "/properties/TargetName",
        "/properties/TargetType",
        "/properties/DeploymentName"
    ]
}